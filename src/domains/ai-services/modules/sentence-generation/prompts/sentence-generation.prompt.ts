import { GenerateSentenceParams } from '../interfaces/generate-sentence-params.interface';
import { PromptTemplate } from '../interfaces/prompt-template.interface';

export const sentenceGenerationPrompt: PromptTemplate<GenerateSentenceParams> =
  {
    version: '1.9.0',
    template: `Создай одно образцовое учебное предложение на английском языке и его перевод.

**Параметры:**
- Слово: "{{word}}" ({{partOfSpeech}}, перевод: {{russianTranslation}})
- Грамматика: "{{grammarTopic}}"
- Уровень CEFR: {{cefrLevel}}

**Общие требования:**
- Создай осмысленное, полезное и запоминающееся предложение с ясным контекстом
- Включи конкретные детали вместо абстрактных утверждений 
- Естественное звучание, современное использование языка
- Грамматика "{{grammarTopic}}" должна быть явно продемонстрирована
- Ключевое слово "{{word}}" используется согласно части речи в понятном контексте
- Избегай банальных, абстрактных или бессодержательных утверждений
- Избегай оценочных прилагательных (good, interesting) без конкретизации

**Специфика для уровня {{cefrLevel}}:**

{{#if cefrLevel === "A0"}}
- Очень простое предложение (4-5 слов)
- Только самая базовая лексика (приветствия, числа, цвета)
- Простейшая структура (подлежащее + сказуемое)
- Контекст: знакомство, семья, класс, еда, простые ситуации
{{/if}}

{{#if cefrLevel === "A1"}}
- Простое предложение (5-7 слов)
- Базовая лексика повседневного общения
- Простая структура (подлежащее + сказуемое + дополнение)
- Контекст: семья, дом, еда, хобби, распорядок дня, школа, домашние животные, друзья, покупки
- Включай детали для большей конкретности (имена, характеристики, время)
{{/if}}

{{#if cefrLevel === "A2"}}
- Простое предложение (6-9 слов)
- Базовая лексика + 1-2 слова следующего уровня
- Простая структура с возможным использованием союзов
- Контекст: работа, путешествия, покупки, погода, транспорт, одежда, здоровье, рестораны
- Старайся включать контекстуальные детали: место, время или особенности
{{/if}}

{{#if cefrLevel === "B1"}}
- Предложение средней сложности (8-12 слов)
- Разнообразная лексика с некоторыми абстрактными понятиями
- Составная структура с союзами и/или причастными оборотами
- Контекст: работа, учеба, досуг, планы, опыт, эмоции, мнения, окружающая среда, технологии
- Используй конкретные примеры и некоторые специфические детали
{{/if}}

{{#if cefrLevel === "B2"}}
- Сложное предложение (10-15 слов)
- Разнообразная и специализированная лексика
- Сложная структура с придаточными предложениями
- Контекст: общественные вопросы, культура, технологии, наука, политика, экономика, образование
- Включай некоторую фактическую информацию или примеры из реальной жизни
{{/if}}

{{#if cefrLevel === "C1Plus"}}
- Продвинутое сложное предложение (12-20 слов)
- Богатая лексика с нюансами значения, включая идиомы и термины
- Изысканные грамматические конструкции, логические связки, сложноподчиненные предложения
- Контекст: профессиональные темы, философия, общественные вопросы, этика, международные отношения
- Включай некоторые конкретные факты, данные или отсылки к событиям
{{/if}}

**Примеры хороших предложений:**
- A1 (word: reading): "This reading book has colorful pictures."
- A1 (word: reading): "My reading class starts at nine."
- A2 (word: science, grammar: Comparatives): "Biology is more interesting than computer science for many students."
- B1 (word: science, grammar: Present Perfect): "Scientists have made important discoveries in medical science during the last decade."

**Примеры проблемных предложений (избегай таких):**
- "This reading is good." (слишком абстрактно, нет контекста)
- "Math is harder than science." (слишком общее утверждение)
- "Science is interesting." (банально, нет конкретики)

**Требования к переводу:**
- Естественная русская речь для поля russianTranslation
- Точная передача смысла оригинала
- Дословный перевод, показывающий грамматическую структуру английского предложения, поместить в поле literalTranslation

**Формат ответа (только JSON):**
\`\`\`json
{
  "englishSentence": "Естественное английское предложение с ключевым словом и грамматикой",
  "russianTranslation": "Естественный перевод на русский язык",
  "literalTranslation": "Дословный перевод, показывающий грамматическую структуру"
}
\`\`\``,

    render: (params: GenerateSentenceParams): string => {
      let resultString = sentenceGenerationPrompt.template;

      // Заменяем все плейсхолдеры их значениями
      Object.entries(params).forEach(([key, value]) => {
        resultString = resultString.replace(
          new RegExp(`{{${key}}}`, 'g'),
          value,
        );
      });

      // Обрабатываем условные блоки для конкретного уровня CEFR
      const cefrLevel = params.cefrLevel;
      const cefrLevels = ['A0', 'A1', 'A2', 'B1', 'B2', 'C1Plus'];

      cefrLevels.forEach((level) => {
        const ifPattern = new RegExp(
          `{{#if cefrLevel === "${level}"}}([\\s\\S]*?){{/if}}`,
          'g',
        );

        if (level === cefrLevel) {
          // Если это текущий уровень, удаляем теги условия, но оставляем содержимое
          resultString = resultString.replace(ifPattern, (_match, content) => {
            return String(content);
          });
        } else {
          // Если это не текущий уровень, удаляем весь блок
          resultString = resultString.replace(ifPattern, '');
        }
      });

      return resultString;
    },
  };
