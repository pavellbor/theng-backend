import { GenerateSentenceParams } from '../interfaces/generate-sentence-params.interface';
import { PromptTemplate } from '../interfaces/prompt-template.interface';

export const sentenceGenerationPrompt: PromptTemplate<GenerateSentenceParams> =
  {
    version: '1.7.0',
    template: `Создай одно образцовое учебное предложение на английском языке и его перевод.

**Параметры:**
- Слово: "{{word}}" ({{partOfSpeech}}, перевод: {{russianTranslation}})
- Грамматика: "{{grammarTopic}}"
- Уровень CEFR: {{cefrLevel}}

**Общие требования:**
- Создай осмысленное, полезное и запоминающееся предложение, демонстрирующее реальную языковую ситуацию
- Естественное звучание, современное использование языка
- Грамматика "{{grammarTopic}}" должна быть естественно интегрирована
- Ключевое слово "{{word}}" используется согласно части речи
- ВАЖНО: избегай абсурдных, бессмысленных или очевидно ложных утверждений
- Используй конкретные примеры вместо абстрактных утверждений
- Если возможно, включи элементы культурной значимости или контекста

**Специфика для уровня {{cefrLevel}}:**

{{#if cefrLevel === "A0"}}
- Очень простое предложение (до 5 слов)
- Только самая базовая лексика (приветствия, числа, цвета)
- Простейшая структура (подлежащее + сказуемое)
- Контекст: базовые приветствия, представление себя, простые факты о мире
{{/if}}

{{#if cefrLevel === "A1"}}
- Простое предложение (до 7 слов)
- Базовая лексика повседневного общения
- Простая структура (подлежащее + сказуемое + дополнение)
- Контекст: семья, дом, еда, хобби, распорядок дня, школа, домашние животные, друзья, покупки, погода, время
- Примеры бытовых ситуаций с конкретными деталями
{{/if}}

{{#if cefrLevel === "A2"}}
- Простое предложение (до 8-9 слов)
- Базовая лексика + 1-2 слова следующего уровня
- Простая структура с возможным использованием союзов
- Контекст: работа, путешествия, покупки, погода, транспорт, одежда, здоровье, рестораны, городская жизнь, выходные, праздники
- Используй реальные примеры с конкретными местами или ситуациями
{{/if}}

{{#if cefrLevel === "B1"}}
- Предложение средней сложности (до 10-12 слов)
- Разнообразная лексика с абстрактными понятиями
- Составная структура с союзами и/или причастными оборотами
- Контекст: работа, учеба, досуг, планы, опыт, эмоции, мнения, окружающая среда, технологии, СМИ, спорт, культурные события
- Включай специфические детали, имена или места для большей реалистичности
{{/if}}

{{#if cefrLevel === "B2"}}
- Сложное предложение (до 12-15 слов)
- Разнообразная и специализированная лексика
- Сложная структура с придаточными предложениями
- Контекст: общественные вопросы, культура, технологии, наука, политика, экономика, образование, глобальные проблемы, литература, искусство, история, психология
- Включай фактическую информацию, примеры из реальной жизни или культурные отсылки
{{/if}}

{{#if cefrLevel === "C1Plus"}}
- Продвинутое сложное предложение (до 15-20 слов)
- Богатая лексика с нюансами значения, включая идиомы и специализированные термины
- Изысканные грамматические конструкции, логические связки, сложноподчиненные предложения
- Контекст: профессиональные темы, философия, сложные общественные вопросы, этика, международные отношения, дебаты, культурная идентичность, современное искусство, научные исследования, аналитика, академический язык, литературные произведения
- Включай информативные утверждения, отражающие реальные знания или дискуссии
{{/if}}

**Примеры хороших предложений:**
- A1 (word: science): "My favorite subject at school is science."
- A2 (word: science, grammar: Comparatives): "Biology is more interesting than computer science for many students."
- B1 (word: science, grammar: Present Perfect): "Scientists have made important discoveries in medical science during the last decade."
- B2 (word: science, grammar: Passive Voice): "Quantum physics is considered one of the most challenging fields of science."

**Примеры ПЛОХИХ предложений (не используй такие!):**
- "Math is harder than science." (слишком общее и неинформативное)
- "Science is interesting." (слишком простое и банальное)
- "I like science more than arts." (слишком субъективное без контекста)

**Требования к переводу:**
- Естественная русская речь для поля russianTranslation
- Точная передача смысла оригинала
- Дословный перевод, показывающий грамматическую структуру английского предложения, поместить в поле literalTranslation

**Формат ответа (только JSON):**
\`\`\`json
{
  "englishSentence": "Естественное английское предложение с ключевым словом и грамматикой",
  "russianTranslation": "Естественный перевод на русский язык",
  "literalTranslation": "Дословный перевод, показывающий грамматическую структуру"
}
\`\`\``,

    render: (params: GenerateSentenceParams): string => {
      let resultString = sentenceGenerationPrompt.template;

      // Заменяем все плейсхолдеры их значениями
      Object.entries(params).forEach(([key, value]) => {
        resultString = resultString.replace(
          new RegExp(`{{${key}}}`, 'g'),
          value,
        );
      });

      // Обрабатываем условные блоки для конкретного уровня CEFR
      const cefrLevel = params.cefrLevel;
      const cefrLevels = ['A0', 'A1', 'A2', 'B1', 'B2', 'C1Plus'];

      cefrLevels.forEach((level) => {
        const ifPattern = new RegExp(
          `{{#if cefrLevel === "${level}"}}([\\s\\S]*?){{/if}}`,
          'g',
        );

        if (level === cefrLevel) {
          // Если это текущий уровень, удаляем теги условия, но оставляем содержимое
          resultString = resultString.replace(ifPattern, (_match, content) => {
            return String(content);
          });
        } else {
          // Если это не текущий уровень, удаляем весь блок
          resultString = resultString.replace(ifPattern, '');
        }
      });

      return resultString;
    },
  };
